"""
Ð¡Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð° Ñ€ÐµÐ°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ñƒ Ð‘Ð¾Ñ”Ñ€Ð°â€“ÐœÑƒÑ€Ð°.
Ð·Ð°ÑÑ‚Ð¾ÑÐ¾Ð²Ð°Ð½Ð¾ Ð»Ð¸ÑˆÐµ Ð¿Ñ–Ð´Ñ…Ñ–Ð´ Ð· Ð¿Ð¾Ð³Ð°Ð½Ð¸Ð¼ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð¼.
Ð“Ð°Ñ€Ð½Ð° Ð´Ð»Ñ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð½Ð¸Ñ… Ñ‚ÐµÐºÑÑ‚Ñ–Ð². Ñƒ Ð³Ñ–Ñ€ÑˆÐ¾Ð¼Ñƒ Ð²Ð¸Ð¿Ð°Ð´ÐºÑƒ Ð¼Ð¾Ð¶Ðµ Ð²ÐµÑÑ‚Ð¸ ÑÐµÐ±Ðµ Ð¿Ð¾Ð²Ñ–Ð»ÑŒÐ½Ð¾.
"""
from __future__ import annotations


def build_last_occurrence(pattern: str) -> dict[str, int]:
    """## ÐŸÐ¾Ð±ÑƒÐ´Ð¾Ð²Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ– Ð¾ÑÑ‚Ð°Ð½Ð½Ñ–Ñ… Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ–Ð² Ñƒ Ð¿Ð°Ñ‚ÐµÑ€Ð½Ñ–

    ---
    #### Ð¯ÐºÑ‰Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñƒ Ð² Ð¿Ð°Ñ‚ÐµÑ€Ð½Ñ– Ð½ÐµÐ¼Ð°Ñ”, Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ð·Ð° Ð·Ð°Ð¼Ð¾Ð²Ñ‡ÑƒÐ²Ð°Ð½Ð½ÑÐ¼ Ð±ÑƒÐ´Ðµ `-1`.
    """
    table: dict[str, int] = {}
    for idx, ch in enumerate(pattern):
        table[ch] = idx
    return table


def search(text: str, pattern: str) -> int:
    """## ÐŸÐ¾Ð²ÐµÑ€Ñ‚Ð°Ñ” Ñ–Ð½Ð´ÐµÐºÑ Ð¿ÐµÑ€ÑˆÐ¾Ð³Ð¾ Ð²Ñ…Ð¾Ð´Ð¶ÐµÐ½Ð½Ñ pattern Ñƒ text Ð°Ð±Ð¾ `-1`

    ---
    #### Ð†Ð¼Ð¿Ð»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²Ð°Ð½Ð¾ Ð»Ð¸ÑˆÐµ Ð¿Ñ–Ð´Ñ…Ñ–Ð´ Ð· Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÐµÑŽ Ð¿Ð¾Ð³Ð°Ð½Ð¾Ð³Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñƒ Ñ‰Ð¾Ð± Ð·Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ñƒ (Ñ– Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½Ñ–ÑÑ‚ÑŒ Ð´Ð»Ñ Ð”Ð—).
    > â˜ðŸ» _Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ– Ð´Ð¾Ð±Ñ€Ð¾Ð³Ð¾ ÑÑƒÑ„Ñ–ÐºÑÑƒ Ð½Ðµ Ð±ÑƒÐ»Ð¾ Ñ€ÐµÐ°Ð»Ñ–Ð·Ð¾Ð²Ð°Ð½Ð¾._
    """
    n = len(text)
    m = len(pattern)
    if m == 0:
        return 0
    if m > n:
        return -1

    last = build_last_occurrence(pattern)
    i = 0
    while i <= n - m:
        j = m - 1
        while j >= 0 and text[i + j] == pattern[j]:
            j -= 1
        if j < 0:
            return i
        # Ð—ÑÑƒÐ²: ÑÐºÑ‰Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñƒ text[i+j] Ð½ÐµÐ¼Ð°Ñ” Ñƒ pattern, last.get(...) Ð´Ð°ÑÑ‚ÑŒ None -> -1
        lo = last.get(text[i + j], -1)
        shift = max(1, j - lo)
        i += shift
    return -1